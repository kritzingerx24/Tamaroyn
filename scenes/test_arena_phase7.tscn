[gd_scene load_steps=20 format=3 uid="uid://b8j2x4q8q8q"]

[ext_resource type="Script" path="res://scripts/player_controller.gd" id="1_tank"]
[ext_resource type="Script" path="res://scripts/ai_tank_controller.gd" id="1_ai"]
[ext_resource type="Script" path="res://scripts/camera_chase.gd" id="2_cam"]
[ext_resource type="Script" path="res://scripts/weapon_system.gd" id="3_wep"]
[ext_resource type="Script" path="res://scripts/uplink_manager.gd" id="4_uplink"]
[ext_resource type="Script" path="res://scripts/terrain_gen.gd" id="5_terr"]
[ext_resource type="Script" path="res://scripts/sky_system.gd" id="6_sky"]
[ext_resource type="Script" path="res://scripts/spawner.gd" id="7_spawner"]
[ext_resource type="Script" path="res://scripts/radar_blip.gd" id="7_blip"]
[ext_resource type="Script" path="res://scripts/minimap_camera.gd" id="8_minic"]

[ext_resource type="PackedScene" uid="uid://tankmesh002" path="res://assets/models/tank_mesh_v2.tscn" id="7_visuals"]
[ext_resource type="PackedScene" uid="uid://cockpithud" path="res://scenes/ui_cockpit.tscn" id="8_hud"]
[ext_resource type="PackedScene" uid="uid://c8j2x4q8q8q" path="res://scenes/projectile.tscn" id="9_proj"]
[ext_resource type="PackedScene" uid="uid://dropship001" path="res://assets/models/dropship.tscn" id="10_ship"]
[ext_resource type="PackedScene" uid="uid://p1w3rC3ll" path="res://scenes/power_cell.tscn" id="11_pc"]
[ext_resource type="PackedScene" uid="uid://turr3tB4s3" path="res://scenes/turret.tscn" id="12_tur"]
[ext_resource type="PackedScene" uid="uid://r3p4irP4d" path="res://scenes/repair_pad.tscn" id="13_rep"]
[ext_resource type="PackedScene" uid="uid://explode" path="res://scenes/explosion.tscn" id="14_exp"]
[ext_resource type="Shader" path="res://assets/shaders/grid_terrain.gdshader" id="14_shd"]

# Audio
[ext_resource type="AudioStream" uid="uid://snd_engine" path="res://assets/audio/engine_loop.wav" id="15_snd"]
[ext_resource type="AudioStream" uid="uid://snd_shoot" path="res://assets/audio/shoot.wav" id="16_snd"]

[sub_resource type="ShaderMaterial" id="mat_grid"]
render_priority = 0
shader = ExtResource("14_shd")
shader_parameter/grid_color = Color(0, 1, 0.2, 1)
shader_parameter/ground_color = Color(0.05, 0.05, 0.05, 1)
shader_parameter/grid_scale = 10.0
shader_parameter/line_thickness = 0.05

[sub_resource type="ProceduralSkyMaterial" id="sky_mat"]
sky_top_color = Color(0.1, 0, 0.2, 1)
sky_horizon_color = Color(0.8, 0.4, 0.1, 1)
ground_bottom_color = Color(0.1, 0.1, 0.1, 1)
ground_horizon_color = Color(0.8, 0.4, 0.1, 1)

[sub_resource type="Sky" id="sky"]
sky_material = SubResource("sky_mat")

[sub_resource type="Environment" id="env"]
background_mode = 2
sky = SubResource("sky")
ambient_light_source = 3
reflected_light_source = 2
tonemap_mode = 2
glow_enabled = true
glow_intensity = 1.5
fog_enabled = true
fog_light_color = Color(0.1, 0.1, 0.1, 1)
fog_density = 0.005

[sub_resource type="BoxShape3D" id="shape_tank"]
size = Vector3(2.5, 1, 4)

[sub_resource type="PackedScene" id="packed_enemy"]
_bundled = {
"conn_count": 0,
"conns": PackedInt32Array(),
"editable_instances": [],
"names": PackedStringArray("EnemyTank", "RigidBody3D", "collision_layer", "collision_mask", "script", "move_speed", "turn_speed", "audio_engine", "Visuals", "instance", "CollisionShape3D", "shape", "SuspensionRay", "RayCast3D", "target_position", "WeaponSystem", "Node3D", "script", "projectile_scene", "muzzle_point", "shoot_sound", "muzzle_flash_light", "EngineSound", "AudioStreamPlayer3D", "stream", "unit_size", "RadarBlip", "color", "MuzzleFlash", "OmniLight3D", "visible", "light_color", "omni_range"),
"node_count": 9,
"node_paths": [NodePath("Visuals"), NodePath("WeaponSystem")],
"nodes": PackedInt32Array(-1, -1, 1, 0, -1, 6, 2, 4, 3, 5, 4, 1, 5, 6, 7, 7, 2147483647, 8, 22, 0, 0, 0, 2147483647, 8, 9, 0, 0, 0, 0, 10, 10, -1, 1, 11, 10, 0, 0, 0, 13, 12, -1, 1, 14, 11, 0, 0, 0, 16, 15, -1, 5, 17, 12, 18, 13, 19, 14, 20, 2147483647, 21, 2147483647, 0, 0, 0, 23, 22, -1, 2, 24, 15, 25, 16, 0, 0, 0, 16, 26, -1, 2, 17, 17, 27, 18, 0, 0, 0, 29, 28, -1, 3, 30, 19, 31, 20, 32, 21, 0),
"variants": [4, 9, ExtResource("1_ai"), 30.0, 1.0, NodePath("EngineSound"), ExtResource("7_visuals"), SubResource("shape_tank"), Vector3(0, -5, 0), ExtResource("3_wep"), ExtResource("9_proj"), NodePath("../Visuals/TurretPivot/MuzzlePoint"), ExtResource("1_ai"), ExtResource("15_snd"), 15.0, ExtResource("7_blip"), Color(1, 0, 0, 1), false, Color(1, 1, 0, 1), 5.0],
"version": 3
}

[node name="World" type="Node3D"]

[node name="WorldEnvironment" type="WorldEnvironment" parent="."]
environment = SubResource("env")
script = ExtResource("6_sky")

[node name="DirectionalLight3D" type="DirectionalLight3D" parent="."]
transform = Transform3D(0.707107, -0.5, 0.5, 0, 0.707107, 0.707107, -0.707107, -0.5, 0.5, 0, 20, 0)
shadow_enabled = true

[node name="Terrain" type="StaticBody3D" parent="."]
collision_mask = 7
script = ExtResource("5_terr")
material = SubResource("mat_grid")

[node name="PlayerTank" type="RigidBody3D" parent="." groups=["player"]]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, 0, 10, 0)
collision_layer = 2
collision_mask = 9
script = ExtResource("1_tank")
audio_engine = NodePath("EngineSound")

[node name="Visuals" parent="PlayerTank" instance=ExtResource("7_visuals")]

[node name="CollisionShape3D" type="CollisionShape3D" parent="PlayerTank"]
shape = SubResource("shape_tank")

[node name="SuspensionRay" type="RayCast3D" parent="PlayerTank"]
target_position = Vector3(0, -5, 0)

[node name="EngineSound" type="AudioStreamPlayer3D" parent="PlayerTank"]
stream = ExtResource("15_snd")
unit_size = 5.0
max_db = -5.0

[node name="WeaponSystem" type="Node3D" parent="PlayerTank" node_paths=PackedStringArray("muzzle_point", "shoot_sound", "muzzle_flash_light")]
script = ExtResource("3_wep")
projectile_scene = ExtResource("9_proj")
muzzle_point = NodePath("../Visuals/TurretPivot/MuzzlePoint")
shoot_sound = NodePath("ShootSound")
muzzle_flash_light = NodePath("MuzzleFlash")

[node name="ShootSound" type="AudioStreamPlayer3D" parent="PlayerTank/WeaponSystem"]
stream = ExtResource("16_snd")
max_db = 0.0

[node name="MuzzleFlash" type="OmniLight3D" parent="PlayerTank/WeaponSystem"]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, 0, 1, -4)
visible = false
light_color = Color(1, 0.8, 0.2, 1)
light_energy = 5.0
omni_range = 10.0

[node name="RadarBlip" type="Node3D" parent="PlayerTank"]
script = ExtResource("7_blip")
color = Color(0, 1, 0, 1)
is_player = true

[node name="Camera3D" type="Camera3D" parent="."]
transform = Transform3D(1, 0, 0, 0, 0.906308, 0.422618, 0, -0.422618, 0.906308, 0, 8, 12)
script = ExtResource("2_cam")
target_path = NodePath("../PlayerTank")

[node name="UplinkManager" type="Node3D" parent="."]
script = ExtResource("4_uplink")
tank_path = NodePath("../PlayerTank")
dropship_scene = ExtResource("10_ship")
buildings = Array[PackedScene]([ExtResource("11_pc"), ExtResource("12_tur"), ExtResource("13_rep")])

[node name="Spawner" type="Node3D" parent="."]
script = ExtResource("7_spawner")
enemy_scene = SubResource("packed_enemy")
explosion_scene = ExtResource("14_exp")

[node name="HUD" parent="." instance=ExtResource("8_hud")]

[node name="MinimapContainer" type="SubViewportContainer" parent="HUD"]
layout_mode = 1
anchors_preset = 1
anchor_left = 1.0
anchor_right = 1.0
offset_left = -220.0
offset_top = 20.0
offset_right = -20.0
offset_bottom = 220.0
grow_horizontal = 0
mouse_filter = 2

[node name="SubViewport" type="SubViewport" parent="HUD/MinimapContainer"]
own_world_3d = true
transparent_bg = true
handle_input_locally = false
size = Vector2i(200, 200)
render_target_update_mode = 4

[node name="RadarCamera" type="Camera3D" parent="HUD/MinimapContainer/SubViewport"]
transform = Transform3D(1, 0, 0, 0, -4.37114e-08, 1, 0, -1, -4.37114e-08, 0, 100, 0)
cull_mask = 512
projection = 1
size = 200.0
script = ExtResource("8_minic")
player_path = NodePath("../../../../PlayerTank")

[connection signal="menu_toggled" from="UplinkManager" to="HUD/BottomBar/Label" method="set_visible"]
